# PythIon ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—è³‡æ–™

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**PythIon** ã¯ã€ãƒŠãƒãƒã‚¢é›»æµãƒ‡ãƒ¼ã‚¿ã®è§£æãƒ»å¯è¦–åŒ–ã‚’è¡Œã†ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Wanunu Lab ã§å†…éƒ¨åˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ä¸»ãªç›®çš„
- ãƒŠãƒãƒã‚¢å®Ÿé¨“ã‹ã‚‰å–å¾—ã—ãŸé›»æµãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãƒ»è¡¨ç¤º
- ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆé›»æµå¤‰åŒ–ï¼‰ã®è‡ªå‹•æ¤œå‡º
- ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆçŠ¶æ…‹ï¼ˆCUSUMæ³•ã«ã‚ˆã‚‹ï¼‰ã®æ¤œå‡º
- è§£æçµæœã®å¯è¦–åŒ–ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| åˆ†é‡ | ä½¿ç”¨æŠ€è¡“ |
|------|----------|
| GUI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | PyQt5 |
| ãƒ—ãƒ­ãƒƒãƒˆãƒ»å¯è¦–åŒ– | pyqtgraph, matplotlib |
| æ•°å€¤è¨ˆç®— | NumPy, SciPy |
| ä¸¦åˆ—å‡¦ç† | multiprocessing |
| ãã®ä»– | tqdm, colorcet, pyyaml |

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Pythion.py                                â”‚
â”‚               (ExtAppMainWindow - ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)              â”‚
â”‚                      â†“ ç¶™æ‰¿                                    â”‚
â”‚              BaseApp.py (BaseAppMainWindow)                   â”‚
â”‚                GUIåŸºç›¤ãƒ»ãƒ—ãƒ­ãƒƒãƒˆè¦ç´ ã®åˆæœŸåŒ–                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  IO.py  â”‚          â”‚Analysis.pyâ”‚          â”‚Painting.pyâ”‚
   â”‚ãƒ•ã‚¡ã‚¤ãƒ«å…¥å‡ºåŠ›â”‚        â”‚ è§£æå‡¦ç†  â”‚          â”‚ æç”»å‡¦ç†  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚              DataTypes.py                           â”‚
   â”‚         (TraceData, FileData ã‚¯ãƒ©ã‚¹)                â”‚
   â”‚              ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨è²¬å‹™

### ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | è²¬å‹™ | ä¸»è¦ã‚¯ãƒ©ã‚¹/é–¢æ•° |
|---------|------|----------------|
| `Pythion.py` | ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ | `ExtAppMainWindow`, `start()` |
| `BaseApp.py` | GUIåŸºç›¤ã€ãƒ—ãƒ­ãƒƒãƒˆè¦ç´ åˆæœŸåŒ– | `BaseAppMainWindow` |
| `DataTypes.py` | ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾© | `TraceData`, `FileData` |
| `Analysis.py` | ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºãƒ»è§£æ | `Config`, `AnalysisResults`, `computeAnalysis()` |
| `IO.py` | ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ | `loadFile()`, `saveAnalysis()` |
| `Painting.py` | ãƒ—ãƒ­ãƒƒãƒˆæç”»å‡¦ç† | `paintCurrentTrace()`, `plotAnalysis()` |
| `Selections.py` | é¸æŠé ˜åŸŸç®¡ç† | `autoFindCutLRs()`, `measureSelections()` |
| `Edits.py` | ãƒ‡ãƒ¼ã‚¿ç·¨é›†æ“ä½œ | `doCut()`, `doBaseline()`, `invertData()` |
| `CUSUMV3.py` | CUSUMã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | `detect_cusum()` |

### UIãƒ•ã‚¡ã‚¤ãƒ« (ui/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `maingui.py/.ui` | ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `loadfile.py/.ui` | ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| `analysissettings.py/.ui` | è§£æè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| `subeventstatesettings.py/.ui` | ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆçŠ¶æ…‹è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| `exportevents.py/.ui` | ã‚¤ãƒ™ãƒ³ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| `exporttraceselection.py/.ui` | é¸æŠé ˜åŸŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚° |
| `ivselection.py/.ui` | I-Vé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚° |

---

## ğŸ”‘ ä¸»è¦ã‚¯ãƒ©ã‚¹è©³ç´°

### 1. TraceData (DataTypes.py)

é›»æµãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚ãƒ‡ãƒ¼ã‚¿ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å‰²ã«å¯¾å¿œã€‚

```python
class TraceData:
    _raw: list[np.ndarray]   # ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ï¼‰
    _filt: list[np.ndarray]  # ãƒ•ã‚£ãƒ«ã‚¿å¾Œãƒ‡ãƒ¼ã‚¿
    srange: list[tuple]      # å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®(é–‹å§‹, çµ‚äº†)ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    original_length: int     # å…ƒãƒ‡ãƒ¼ã‚¿ã®é•·ã•
    source_file_name: str    # å…ƒãƒ•ã‚¡ã‚¤ãƒ«å
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
- `setOriginalData(raw, filt, source)` - åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š
- `trim(trange)` - æŒ‡å®šç¯„å›²ã‚’ã‚«ãƒƒãƒˆ
- `invert()` - é›»æµç¬¦å·ã‚’åè»¢
- `getConcatDataPoints(grange)` - ç¯„å›²æŒ‡å®šã§ãƒ‡ãƒ¼ã‚¿å–å¾—

### 2. FileData (DataTypes.py)

ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®è§£æçŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚

```python
class FileData:
    data: TraceData              # ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿
    analysis_results: AnalysisResults  # è§£æçµæœ
    baseline: float              # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³é›»æµå€¤
    baseline_std: float          # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¨™æº–åå·®
    ADC_samplerate_Hz: float     # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ
    LRs: list[pg.LinearRegionItem]  # é¸æŠé ˜åŸŸãƒªã‚¹ãƒˆ
    t_V_record: np.ndarray       # é›»åœ§è¨˜éŒ²ï¼ˆXMLç”±æ¥ï¼‰
```

### 3. Config (Analysis.py)

è§£æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚

```python
class Config:
    baseline_A: float              # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ [A]
    baseline_std_A: float          # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¨™æº–åå·® [A]
    threshold_A: float             # æ¤œå‡ºé–¾å€¤ [A] (default: 0.3nA)
    enable_subevent_state_detection: bool  # ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºæœ‰åŠ¹åŒ–
    maxNsta: int                   # æœ€å¤§çŠ¶æ…‹æ•° (default: 16)
    cusum_stepsize: int            # CUSUMã‚¹ãƒ†ãƒƒãƒ—ã‚µã‚¤ã‚º
    cusum_threshhold: int          # CUSUMé–¾å€¤
    merge_delta_blockade: float    # çŠ¶æ…‹ãƒãƒ¼ã‚¸é–¾å€¤
    prefilt_window_us: float       # å‰å‡¦ç†ãƒ•ã‚£ãƒ«ã‚¿çª“ [Î¼s]
    state_min_duration_us: float   # æœ€å°çŠ¶æ…‹æŒç¶šæ™‚é–“ [Î¼s]
```

### 4. AnalysisResults (Analysis.py)

è§£æçµæœã‚’æ ¼ç´ã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚

```python
class AnalysisResults:
    analysis_config: Config     # ä½¿ç”¨ã—ãŸè¨­å®š
    result_dtype: np.dtype      # çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®å‹å®šç¾©
    tables: dict[str, np.ndarray]  # çµæœãƒ†ãƒ¼ãƒ–ãƒ«
        # 'Event' - æ¤œå‡ºã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
        # 'CUSUMState' - ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆçŠ¶æ…‹ä¸€è¦§
```

**çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ :**
| ã‚«ãƒ©ãƒ  | å‹ | èª¬æ˜ |
|--------|-----|------|
| id | int | ä¸€æ„è­˜åˆ¥å­ |
| N_child | int | å­çŠ¶æ…‹æ•° |
| parent_id | int | è¦ªã‚¤ãƒ™ãƒ³ãƒˆID |
| category | str | 'Event' or 'CUSUMState' |
| index | int | ã‚¤ãƒ™ãƒ³ãƒˆ/çŠ¶æ…‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |
| seg | int | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç•ªå· |
| local_startpt | int | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…é–‹å§‹ç‚¹ |
| local_endpt | int | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…çµ‚äº†ç‚¹ |
| global_startpt | int | å…¨ä½“ã§ã®é–‹å§‹ç‚¹ |
| global_endpt | int | å…¨ä½“ã§ã®çµ‚äº†ç‚¹ |
| deli | float | Î”I (é›»æµå¤‰åŒ–é‡) |
| frac | float | åˆ†æ•°é›»æµãƒ–ãƒ­ãƒƒã‚¯ |
| dwell | float | æ»ç•™æ™‚é–“ [Î¼s] |
| dt | float | ã‚¤ãƒ™ãƒ³ãƒˆé–“éš” [s] |
| mean | float | å¹³å‡é›»æµ |
| stdev | float | æ¨™æº–åå·® |
| skewness | float | æ­ªåº¦ |
| kurtosis | float | å°–åº¦ |

---

## ğŸ”„ ä¸»è¦å‡¦ç†ãƒ•ãƒ­ãƒ¼

### ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ•ãƒ­ãƒ¼

```
1. UI: File â†’ Load ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
2. LoadFileDialog: ãƒ‘ã‚¹ãƒ»ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š
3. IO.loadFile():
   â”œâ”€â”€ .opt/.bin ãƒ•ã‚¡ã‚¤ãƒ«: np.fromfile() ã§èª­ã¿è¾¼ã¿
   â”‚   â””â”€â”€ Bessel ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ (scipy.signal)
   â”œâ”€â”€ .tracedata ãƒ•ã‚¡ã‚¤ãƒ«: pickle.load()
   â””â”€â”€ .xml ãƒ•ã‚¡ã‚¤ãƒ«: é›»åœ§è¨˜éŒ²ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒˆèª­ã¿è¾¼ã¿
4. TraceData.setOriginalData() ã§ãƒ‡ãƒ¼ã‚¿æ ¼ç´
5. Painting.paintCurrentTrace() ã§æç”»
```

### è§£æãƒ•ãƒ­ãƒ¼

```
1. UI: Analysis â†’ Analyze ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
2. AnalyzeDialog: é–¾å€¤ãƒ»ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
3. Analysis.computeAnalysis():
   â”œâ”€â”€ é–¾å€¤ä»¥ä¸‹ã®ç‚¹ã‚’æ¤œå‡º
   â”œâ”€â”€ ã‚¤ãƒ™ãƒ³ãƒˆé–‹å§‹/çµ‚äº†ç‚¹ã‚’ç‰¹å®š
   â”œâ”€â”€ ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¾ã§ãƒˆãƒ©ãƒƒã‚¯ãƒãƒƒã‚¯
   â”œâ”€â”€ æœ€å°å€¤ä½ç½®ã§çµ‚ç‚¹èª¿æ•´
   â”œâ”€â”€ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) CUSUM ã§ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º
   â”‚   â””â”€â”€ multiprocessing ã§ä¸¦åˆ—å‡¦ç†
   â””â”€â”€ AnalysisResults ã«çµæœæ ¼ç´
4. Painting.plotAnalysis() ã§å¯è¦–åŒ–
5. IO.saveAnalysis() ã§ä¿å­˜
```

### CUSUM (Cumulative Sum) ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```
ç›®çš„: ã‚¤ãƒ™ãƒ³ãƒˆå†…ã®ã‚µãƒ–çŠ¶æ…‹ï¼ˆé›»æµãƒ¬ãƒ™ãƒ«ã®å¤‰åŒ–ç‚¹ï¼‰ã‚’æ¤œå‡º

1. ç§»å‹•å¹³å‡ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã§å‰å‡¦ç†
2. æ­£/è² æ–¹å‘ã‚¸ãƒ£ãƒ³ãƒ—ã®å¯¾æ•°å°¤åº¦ã‚’è¨ˆç®—
3. ç´¯ç©å’ŒãŒé–¾å€¤ã‚’è¶…ãˆãŸã‚‰ã‚¸ãƒ£ãƒ³ãƒ—æ¤œå‡º
4. éåˆ†å‰²ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ãƒãƒ¼ã‚¸ (merge_oversegmentation)
```

---

## ğŸ¨ GUIãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

### ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Menu Bar: File | Edit | Selection | Analysis                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                    Signal Plot (p1)                     â”‚ â”‚
â”‚ â”‚                   é›»æµãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤º                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   Scatter Plot (w1)  â”‚ â”‚ â”‚    Histograms (w2-w5)       â”‚ â”‚
â”‚ â”‚  Dwell vs Blockade   â”‚ â”‚ â”‚  Frac/Deli/Dwell/dt Hist    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   Event Plot (p3)    â”‚ â”‚ â”‚        Log Text             â”‚ â”‚
â”‚ â”‚  å€‹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º      â”‚ â”‚ â”‚      æ“ä½œãƒ­ã‚°è¡¨ç¤º            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ­ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§

| å¤‰æ•°å | è¦ªWidget | ç”¨é€” |
|--------|----------|------|
| `p1` | signalplot | ãƒ¡ã‚¤ãƒ³é›»æµãƒˆãƒ¬ãƒ¼ã‚¹ |
| `w1` | scatterplot | Dwell-Blockage æ•£å¸ƒå›³ |
| `w1std/skew/kurt` | stdev/skew/kurtosisplot | çµ±è¨ˆé‡æ•£å¸ƒå›³ |
| `w2` | frachistplot | Fractional blockage ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  |
| `w3` | delihistplot | Î”I ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  |
| `w4` | dwellhistplot | Dwell time ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  |
| `w5` | dthistplot | ã‚¤ãƒ™ãƒ³ãƒˆé–“éš”ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  |
| `p3` | eventplot | å€‹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´° |

---

## ğŸ“ ä¸»è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### File ãƒ¡ãƒ‹ãƒ¥ãƒ¼
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | é–¢æ•° | èª¬æ˜ |
|-----------|------|------|
| Load | `IO.LoadFileDialog` | ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ |
| Reload | `IO.loadFile()` | å†èª­ã¿è¾¼ã¿ |
| Save Traces | `IO.saveTrace()` | ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (.tracedata) |
| Save Segment Info | `IO.saveSegInfo()` | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±ä¿å­˜ |

### Edit ãƒ¡ãƒ‹ãƒ¥ãƒ¼
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | é–¢æ•° | èª¬æ˜ |
|-----------|------|------|
| Cut | `Edits.doCut()` | é¸æŠç¯„å›²ã‚’ã‚«ãƒƒãƒˆ |
| Set Baseline | `Edits.doBaseline()` | é¸æŠç¯„å›²ã‹ã‚‰ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨­å®š |
| Invert Current Sign | `Edits.invertData()` | é›»æµç¬¦å·åè»¢ |

### Selection ãƒ¡ãƒ‹ãƒ¥ãƒ¼
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ | é–¢æ•° |
|-----------|--------------|------|
| Auto Detect Clears | Alt+A | `Selections.autoFindCutLRs()` |
| Add One Cut Region | Alt+D | `Selections.addOneManualCutLR()` |
| Delete Last Cut Region | - | `Selections.deleteOneCutLR()` |
| Clear Selections | - | `Selections.clearLRs()` |
| Export Data | - | `IO.exportSelection()` |
| Export Measurement | - | `Selections.measureSelections()` |
| Inspect Selection | - | `Painting.inspectSelection()` |

### Analysis ãƒ¡ãƒ‹ãƒ¥ãƒ¼
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | é–¢æ•° | èª¬æ˜ |
|-----------|------|------|
| Analyze | `Analysis.AnalyzeDialog` | ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºå®Ÿè¡Œ |
| Subevent State Settings | `Analysis.SubEventStateSettingsDialog` | CUSUMè¨­å®š |
| Repaint Analysis | `Painting.plotAnalysis()` | è§£æçµæœå†æç”» |

---

## ğŸ”§ é–‹ç™ºã®ãƒ’ãƒ³ãƒˆ

### æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **æ–°ã—ã„ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**
   ```python
   # 1. ui/ ã« .ui ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ (Qt Designer)
   # 2. pyuic5 ã§ .py ã«å¤‰æ›
   # 3. æ–°ã—ã„Dialog ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
   class MyDialog(QtWidgets.QDialog):
       def __init__(self, parent:BaseAppMainWindow):
           self.parent = parent
           super().__init__(parent)
           self.ui = Ui_MyDialog()
           self.ui.setupUi(self)
           self.accepted.connect(self.dialogAccept)
   ```

2. **æ–°ã—ã„è§£æå‡¦ç†ã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**
   ```python
   # Analysis.py ã«å‡¦ç†é–¢æ•°ã‚’è¿½åŠ 
   def myNewAnalysis(app: BaseAppMainWindow):
       # app.perfiledata.data ã‹ã‚‰å…¥åŠ›ãƒ‡ãƒ¼ã‚¿å–å¾—
       # å‡¦ç†å®Ÿè¡Œ
       # app.perfiledata.analysis_results.tables['MyResult'] = result
   ```

3. **æ–°ã—ã„ãƒ—ãƒ­ãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**
   ```python
   # BaseApp.py ã® __init__ ã§ãƒ—ãƒ­ãƒƒãƒˆè¦ç´ åˆæœŸåŒ–
   self.my_plot = self.ui.myplotwidget.addPlot()
   
   # Painting.py ã§æç”»å‡¦ç†
   def plotMyData(app: BaseAppMainWindow):
       app.my_plot.clear()
       app.my_plot.plot(x, y, pen='b')
   ```

### ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
app.perfiledata.data           # TraceData ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
app.perfiledata.data.filt[k]   # kç•ªç›®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ‡ãƒ¼ã‚¿
app.perfiledata.data.srange    # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç¯„å›²ãƒªã‚¹ãƒˆ
app.perfiledata.ADC_samplerate_Hz  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ

# ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
app.ui_baseline        # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³å€¤
app.ui_baseline_std    # ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¨™æº–åå·®

# è§£æè¨­å®š
app.analysis_config.threshold_A  # æ¤œå‡ºé–¾å€¤
app.analysis_config.enable_subevent_state_detection  # ã‚µãƒ–ã‚¤ãƒ™ãƒ³ãƒˆæœ‰åŠ¹

# è§£æçµæœ
app.perfiledata.analysis_results.tables['Event']      # ã‚¤ãƒ™ãƒ³ãƒˆçµæœ
app.perfiledata.analysis_results.tables['CUSUMState'] # çŠ¶æ…‹çµæœ
```

### pyqtgraph ãƒ—ãƒ­ãƒƒãƒˆæ“ä½œ

```python
# ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒƒãƒˆ
handle = app.p1.plot(x, y, pen='b')  # ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ãƒƒãƒˆ
handle.setDownsampling(ds=4096, auto=False, method='peak')

# æ•£å¸ƒå›³
scatter = pg.ScatterPlotItem()
scatter.addPoints(x=x, y=y, symbol='o', brush='r', size=5)
app.w1.addItem(scatter)

# ç·šè¿½åŠ 
app.p1.addLine(y=baseline, pen='g')

# é¸æŠé ˜åŸŸ
lr = pg.LinearRegionItem()
lr.setRegion((start, end))
app.p1.addItem(lr)
```

---

## ğŸ“š ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|-----|------|
| Event | é›»æµãŒãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‹ã‚‰é–¾å€¤ä»¥ä¸‹ã«ä½ä¸‹ã—ãŸæœŸé–“ |
| Subevent State | ã‚¤ãƒ™ãƒ³ãƒˆå†…ã®é›»æµãƒ¬ãƒ™ãƒ«å¤‰åŒ–ã§åŒºåˆ‡ã‚‰ã‚ŒãŸã‚µãƒ–åŒºé–“ |
| Dwell Time | ã‚¤ãƒ™ãƒ³ãƒˆã®æŒç¶šæ™‚é–“ [Î¼s] |
| Î”I (deli) | é›»æµå¤‰åŒ–é‡ = baseline - event_mean |
| Fractional Blockage (frac) | deli / baseline |
| Baseline | å®šå¸¸çŠ¶æ…‹ã®é›»æµå€¤ |
| Segment | ã‚«ãƒƒãƒˆæ“ä½œã§åˆ†å‰²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿åŒºé–“ |
| CUSUM | Cumulative Sum - å¤‰åŒ–ç‚¹æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
| LinearRegionItem (LR) | pyqtgraph ã®é¸æŠé ˜åŸŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ |

---

## ğŸš€ èµ·å‹•æ–¹æ³•

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -e .

# èµ·å‹•
PythIon

# ã¾ãŸã¯
python -m PythIon
```

---

## ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«
| æ‹¡å¼µå­ | å½¢å¼ | ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ |
|--------|------|------------|
| `.opt` | ãƒã‚¤ãƒŠãƒª (float64) | Big endian |
| `.bin` | ãƒã‚¤ãƒŠãƒª (float64) | Little endian |
| `.tracedata` | pickle (TraceData) | - |
| `.xml` | XMLãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | - |

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
| æ‹¡å¼µå­ | å†…å®¹ |
|--------|------|
| `.tracedata` | å‡¦ç†æ¸ˆã¿ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ |
| `_analysis/` | è§£æçµæœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `*_segments.txt` | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ± |
| `*_measurement.txt` | æ¸¬å®šçµæœ |
| `*_log.txt` | æ“ä½œãƒ­ã‚° |
